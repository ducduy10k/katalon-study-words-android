pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                echo 'Checkout source code from GitHub...'
                checkout([$class: 'GitSCM',
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[url: 'https://github.com/ducduy10k/katalon-study-words-android.git']]
                ])
            }
        }

        stage('Run Katalon Tests (Docker)') {
            steps {
                echo "Running Katalon Test Suite using Docker container..."
                sh """
                     "/Users/nguyenduy/Downloads/Katalon_Studio_Engine_MacOS-10.4.0/Katalon Studio Engine.app/Contents/MacOS/katalonc" \
                     -noSplash \
                     -runMode=console \
                     -projectPath="/Users/nguyenduy/Desktop/Tester/Katalon/study_words_android_katalon/Android Mobile Tests with Katalon Studio.prj" \
                     -retry=0 -testSuitePath="Test Suites/Open App" -browserType="Android" -deviceId="2bc37605" -executionProfile="default" \
                      --config -proxy.auth.option=NO_PROXY -proxy.system.option=NO_PROXY -proxy.system.applyToDesiredCapabilities=true -webui.autoUpdateDrivers=true \
                     -appiumDirectory="/Users/nguyenduy/.nvm/versions/node/v24.11.0/lib/node_modules/appium"
                    """
            }
        }


        stage('Archive Reports') {
            steps {
                echo 'Archiving test reports...'
                archiveArtifacts artifacts: 'Reports/**/*', fingerprint: true
            }
        }
    }

    post {
        failure {
            echo 'Katalon tests failed!'
        }
        success {
            echo 'Katalon tests succeeded!'
        }
    }
}
